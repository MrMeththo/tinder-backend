// prisma/schema.prisma

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  passwordHash String
  age          Int?
  bio          String?
  gender       String?
  photoUrl     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  swipesFrom Swipe[] @relation("swipesFrom")
  swipesTo   Swipe[] @relation("swipesTo")

  matches1 Match[] @relation("matches1")
  matches2 Match[] @relation("matches2")

  messages Message[] @relation("messageSender")
}

model Swipe {
  id         String   @id @default(uuid())
  fromUser   User     @relation("swipesFrom", fields: [fromUserId], references: [id])
  fromUserId String
  toUser     User     @relation("swipesTo", fields: [toUserId], references: [id])
  toUserId   String
  direction  String   // 'like' | 'pass' | 'superlike'
  createdAt  DateTime @default(now())

  @@index([fromUserId, createdAt])
}

model Match {
  id        String   @id @default(uuid())
  user1     User     @relation("matches1", fields: [user1Id], references: [id])
  user1Id   String
  user2     User     @relation("matches2", fields: [user2Id], references: [id])
  user2Id   String
  createdAt DateTime @default(now())

  messages Message[]

  @@unique([user1Id, user2Id], name: "user1Id_user2Id")
}

model Message {
  id        String   @id @default(uuid())
  match     Match    @relation(fields: [matchId], references: [id])
  matchId   String
  sender    User     @relation("messageSender", fields: [senderId], references: [id])
  senderId  String
  text      String
  createdAt DateTime @default(now())

  @@index([matchId, createdAt])
}
